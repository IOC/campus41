define(["jquery","core/config","core/notification"],function(a,b,c){return{init:function(){if(a("body").hasClass("format-cre")&&a("body").hasClass("cre-mod-form")&&a("body").removeClass("jsenabled"),a("body").hasClass("cre-index")){var c,d=a("#page-content ol li"),e=a(".course-content-footer .cre-transport-index"),f=a(".course-content-footer .cre-path-index");if(a.each(d,function(b,d){c=a("<span>",{"class":"cre-index-text",html:a(d).text()}),a(d).html("").append(c)}),e.length>0){a("body").addClass("transport-animated");var g=a("#page-content ol li:last-child");g.length&&g.append(e)}if(f.length>0){var g=a("#page-content ol li:nth-last-child(2)");g.length?g.append(f):f.hide()}}if(a("body").hasClass("format-cre")&&a("body").hasClass("path-mod")&&a(".pauta-revisio").length>0){var h,i=this,d=a(".format-cre .pauta-revisio li"),j="",k=a("<input/>",{type:"checkbox",name:"cre-pauta-revisio","aria-hidden":"true",value:""}),l=a("<span/>",{"class":"cre-checkbox"}),m=a("<label/>");a.each(d,function(b,c){j=a(c).text(),h=m.clone(),a(c).empty().append(h.html(j)),a(h).prepend(l.clone()).prepend(k.clone().val(b))});var n={action:"gettasks",courseid:a('#theme-cre-params input[name="courseid"]').val(),cmid:a('#theme-cre-params input[name="cmid"]').val(),sesskey:b.sesskey};this.callAjax(n),a(document).on("click",".format-cre .pauta-revisio input",function(){n={action:a(this).is(":checked")?"taskdone":"tasktodo",courseid:a('#theme-cre-params input[name="courseid"]').val(),cmid:a('#theme-cre-params input[name="cmid"]').val(),task:parseInt(a(this).val()),sesskey:b.sesskey},i.callAjax(n)})}if(a("body").hasClass("cre-module")&&("page-mod-forum-discuss"==a("body").attr("id")||"page-mod-forum-post"==a("body").attr("id")||"page-mod-forum-view"==a("body").attr("id"))){var o,p=a(".options .commands a");p.length&&a.each(p,function(b,c){o=a(c).attr("href"),o.search(/discuss\.php/i)>0?a(c).addClass("forum-link").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?edit/i)>0?a(c).addClass("forum-edit").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?prune/i)>0?a(c).addClass("forum-prune").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?delete/i)>0?a(c).addClass("forum-delete").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?reply/i)>0?a(c).addClass("forum-reply").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/portfolio/i)>0?a(c).attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?fav/i)>0?a(c).addClass("forum-fav").attr("title",a(c).text()).attr("aria-label",a(c).text()):o.search(/\?unfav/i)>0&&a(c).addClass("forum-unfav").attr("title",a(c).text()).attr("aria-label",a(c).text())})}},callAjax:function(d){var e={context:this,type:"POST",dataType:"json",data:d},f=b.wwwroot+"/theme/cre/ajax.php";a.ajax(f,e).then(function(a){a.error?c.addNotification({message:a.error,type:"error"}):a.values&&this.setCheckboxes(a.values)}).fail(c.exception)},setCheckboxes:function(b){if(b){var c=a(".format-cre .pauta-revisio li input");a.each(b,function(a,b){c.eq(b).attr("checked","checked")})}}}});